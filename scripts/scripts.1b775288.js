"use strict";angular.module("g2gMobileApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/profile/:id",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).when("/logout/:id",{templateUrl:"views/logout.html",controller:"LogoutCtrl"}).when("/auth/:id",{templateUrl:"views/auth.html",controller:"AuthCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("g2gMobileApp").controller("MainCtrl",["$scope","$http","$window",function(a,b,c){a.isLoggedIn=null,null!==localStorage.getItem("token")?(a.isLoggedIn="true",a.token=localStorage.getItem("token"),console.log(a.token),b.post("https://get2gether.me/api/getUserData",{token:a.token}).success(function(b,c,d,e){a.status=c,a.headers=d,a.config=e,a.response=b,a.me=b.data,a.me.lastCheckInDate=new Date(1e3*a.me.lastCheckIn),null===localStorage.getItem("localStorageAccuracy")?(console.log("setting accuracy to mongoDB value - does not exist in localStorage"),a.me.accuracy=a.me.accuracy,localStorage.setItem("localStorageAccuracy",a.me.accuracy)):(console.log("setting accuracy to localStorage - exists"),a.me.accuracy=Number(localStorage.getItem("localStorageAccuracy"))),null===localStorage.getItem("localStorageLatitude")?(a.me.latitude=a.me.location[1].toFixed(a.accuracy),a.me.longitude=a.me.location[0].toFixed(a.accuracy)):(a.me.latitude=localStorage.getItem("localStorageLatitude"),a.me.longitude=localStorage.getItem("localStorageLongitude"))}).error(function(b,c,d,e){a.data=b,a.status=c,a.headers=d,a.config=e}).then(function(){console.log("lat"),console.log(Number(localStorage.getItem("localStorageLatitude"))),console.log("accuracy"),console.log(localStorage.getItem("localStorageAccuracy")),b.post("https://get2gether.me/api/checkin",{token:a.token,lat:Number(localStorage.getItem("localStorageLatitude")),lng:Number(localStorage.getItem("localStorageLongitude")),accuracy:Number(localStorage.getItem("localStorageAccuracy"))}).success(function(b,d,e,f){if(a.status=d,a.headers=e,a.config=f,a.response=b,a.success=b.success,a.success===!0){a.data=b.data,a.users=a.data.users,a.map=c.map;for(var g=0,h=a.users.length;h>g;g++){var i=a.users[g],j=i.name,k=i.location[0],l=i.location[1],m=new google.maps.LatLng(l,k),n=new google.maps.Marker({position:m,map:map,title:j});n.id=g;var o=new google.maps.InfoWindow({content:"",maxWidth:350});google.maps.event.addListener(n,"click",function(a,b){return function(){var c="<div class='profile-info'>";c+="<p><strong>"+b.name+"</strong></p>",c+="<img src='"+b.image+"'>",c+="</div>",o.setContent(c),o.open(map,a)}}(n,i)),console.log("user: "+a.users[g].lastCheckIn),a.users[g].lastCheckInDate=new Date(1e3*a.users[g].lastCheckIn)}}else console.log("There was an issue making this request.")}).error(function(b,c,d,e){a.data=b,a.status=c,a.headers=d,a.config=e})})):a.isLoggedIn="false"}]),angular.module("g2gMobileApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("g2gMobileApp").controller("ProfileCtrl",["$scope","$http",function(a,b){a.accuracy=localStorage.getItem("localStorageAccuracy"),null!==localStorage.getItem("token")?(a.isLoggedIn="true",a.token=localStorage.getItem("token"),console.log(a.token),b.post("https://get2gether.me/api/getUserData",{token:a.token}).success(function(b,c,d,e){a.status=c,a.headers=d,a.config=e,a.response=b,a.me=b.data,a.me.lastCheckInDate=new Date(1e3*a.me.lastCheckIn),null===localStorage.getItem("localStorageAccuracy")?(console.log("setting accuracy to mongoDB value - does not exist in localStorage"),a.me.accuracy=a.me.accuracy,localStorage.setItem("localStorageAccuracy",a.me.accuracy)):(console.log("setting accuracy to localStorage - exists"),a.me.accuracy=Number(localStorage.getItem("localStorageAccuracy"))),null===localStorage.getItem("localStorageLatitude")?(a.me.latitude=a.me.location[1].toFixed(a.accuracy),a.me.longitude=a.me.location[0].toFixed(a.accuracy)):(a.me.latitude=localStorage.getItem("localStorageLatitude"),a.me.longitude=localStorage.getItem("localStorageLongitude"))}).error(function(b,c,d,e){a.data=b,a.status=c,a.headers=d,a.config=e})):a.isLoggedIn="false"}]),angular.module("g2gMobileApp").controller("LogoutCtrl",["$scope","$http","$location",function(a,b,c){b.post("https://get2gether.me/api/logout",{token:localStorage.getItem("token")}).success(function(b,c,d,e){a.response=b,a.status=c,a.headers=d,a.config=e}).error(function(b,c,d,e){a.data=b,a.status=c,a.headers=d,a.config=e}),localStorage.removeItem("token"),c.route("")}]),angular.module("g2gMobileApp").controller("AuthCtrl",["$scope","$routeParams","$window",function(a,b,c){localStorage.setItem("token",b.id),c.location.href="/"}]);